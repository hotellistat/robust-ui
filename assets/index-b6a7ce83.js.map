{"version":3,"file":"index-b6a7ce83.js","sources":["../../src/components/Select/index.vue"],"sourcesContent":["<script lang=\"ts\">\nexport default {\n  name: 'RobustSelect',\n  inheritAttrs: false,\n};\n</script>\n\n<script lang=\"ts\" setup>\nimport RobustInputWrapper from '../InputWrapper/index.vue';\nimport FLoating from '../Floating/index.vue';\nimport {\n  ref,\n  computed,\n  nextTick,\n  toRefs,\n  onMounted,\n  inject,\n  PropType,\n} from 'vue';\nimport { MaybeRef, debouncedWatch } from '@vueuse/core';\nimport { onClickOutside } from '@vueuse/core';\nimport { PhCheck, PhCaretDown } from '@phosphor-icons/vue';\nimport { size } from '@floating-ui/vue';\n\nexport type Value = string | number | boolean | null | undefined;\n\nexport interface Option {\n  title: string;\n  value: Value;\n  class?: string;\n}\n\nconst props = defineProps({\n  title: {\n    type: String,\n    default: undefined,\n  },\n  class: {\n    type: String as PropType<string | string[] | object>,\n    default: undefined,\n  },\n  boxClass: {\n    type: String as PropType<string | string[] | object>,\n    default: undefined,\n  },\n  hint: {\n    type: String,\n    default: undefined,\n  },\n  error: {\n    type: String,\n    default: undefined,\n  },\n  fixedHeight: {\n    type: Boolean,\n    default: true,\n  },\n  readonly: {\n    type: Boolean,\n    default: false,\n  },\n  condensed: {\n    type: Boolean,\n    default: false,\n  },\n  disabled: {\n    type: Boolean,\n    default: false,\n  },\n  searchable: {\n    type: Boolean,\n    default: true,\n  },\n  searchFunction: {\n    type: Function as PropType<(query: string) => Promise<Array<Option>>>,\n    default: undefined,\n  },\n  placeholder: {\n    type: String,\n    default: 'Select',\n  },\n  options: {\n    type: Array as PropType<Array<Option>>,\n    default: () => [],\n  },\n  modelValue: {\n    type: [String, Number, Boolean, Array] as PropType<Value | Array<Value>>,\n    default: undefined,\n  },\n  lazy: {\n    type: Boolean,\n    default: false,\n  },\n});\n\nconst emit = defineEmits([\n  'update:modelValue',\n  'input',\n  'change',\n  'focus',\n  'blur',\n  'search',\n]);\n// const refSelectContainer = ref()\nconst refSelectInput = ref();\n\nconst refSelectWrapper = ref();\nconst { options, modelValue } = toRefs(props);\n\nconst anchorRef = ref();\n\nconst open = ref(false);\nconst elementRef = ref();\n// const inputWrapper = ref()\n\nconst search = ref('');\n\nconst middleware = [\n  // size({\n  //   apply({ rects }) {\n  //     Object.assign(elementRef.value.style, {\n  //       width: `${rects.reference.width}px`,\n  //     });\n  //   },\n  // }),\n];\n\nconst computedOptions = ref<Option[]>([]);\n\nasync function filterBySearchTerm(value) {\n  if (props.searchFunction !== undefined) {\n    computedOptions.value = await props.searchFunction(value);\n  }\n\n  if (value === '') {\n    computedOptions.value = options.value;\n  } else {\n    computedOptions.value = options.value.filter((option) =>\n      option.title.toLowerCase().includes(value.toLowerCase())\n    );\n  }\n}\n\ndebouncedWatch(\n  options,\n  async () => {\n    if (!props.lazy) {\n      await filterBySearchTerm(search.value);\n    }\n  },\n  { debounce: 150 }\n);\n\ndebouncedWatch(\n  search,\n  async (value) => {\n    if (!props.lazy) {\n      await filterBySearchTerm(search.value);\n    }\n    emit('search', value);\n  },\n  { debounce: 150 }\n);\n\nonClickOutside(elementRef, (event) => {\n  if (!open.value) {\n    return;\n  }\n\n  if (refSelectWrapper.value?.wrapperRef.contains(event.target)) {\n    event.stopPropagation();\n  }\n\n  resetFields();\n  closeDropdown();\n});\n\nfunction openDropdown(event) {\n  open.value = true;\n  sortOptionsBySelected();\n  nextTick(() => {\n    if (refSelectInput.value) {\n      refSelectInput.value.focus();\n    }\n  });\n  emit('focus');\n}\n\nfunction closeDropdown() {\n  open.value = false;\n  emit('blur');\n}\n\nonMounted(async () => {\n  await filterBySearchTerm('');\n});\n\nconst activeItem = computed(() => {\n  return props.options.find((item) => item.value === props.modelValue);\n});\n\nfunction selectItem(item) {\n  if (Array.isArray(modelValue.value)) {\n    let updatedValue = modelValue.value;\n    if (modelValue.value.includes(item.value)) {\n      updatedValue = modelValue.value.filter((v) => v !== item.value);\n    } else {\n      updatedValue = [...updatedValue, item.value];\n    }\n    emit('input', updatedValue);\n    emit('change', updatedValue);\n    emit('update:modelValue', updatedValue);\n  } else {\n    emit('input', item.value);\n    if (item.value !== props.modelValue) {\n      emit('change', item.value);\n      emit('update:modelValue', item.value);\n    }\n    nextTick(() => {\n      closeDropdown();\n      emit('blur');\n    });\n  }\n}\n\nconsole.log(refSelectWrapper);\n\nfunction resetFields() {\n  search.value = '';\n}\n\n// returns if options is selected\n// in form of boolean\nfunction optionSelected(option: any) {\n  if (Array.isArray(modelValue.value)) {\n    return modelValue.value.includes(option.value);\n  }\n  return modelValue.value === option.value;\n}\n\nfunction getInputTitle() {\n  if (Array.isArray(modelValue.value)) {\n    if (modelValue.value.length < 1) {\n      return props.placeholder;\n    }\n    const titles = [];\n    for (const value of modelValue.value) {\n      const found = options.value.find((o) => o.value === value);\n      titles.push(found.title);\n    }\n    return titles.join(', ');\n  } else {\n    return activeItem.value ? activeItem.value.title : props.placeholder;\n  }\n}\n\nfunction sortOptionsBySelected() {\n  if (Array.isArray(modelValue.value)) {\n    const selectedOptions = [];\n    const notSelectedOptions = [];\n\n    for (const option of computedOptions.value) {\n      if (modelValue.value.includes(option.value)) {\n        selectedOptions.push(option);\n      } else {\n        notSelectedOptions.push(option);\n      }\n    }\n\n    computedOptions.value = [...selectedOptions, ...notSelectedOptions];\n    console.log(computedOptions.value);\n  }\n}\n\nfunction controlAll() {\n  if (!Array.isArray(modelValue.value)) {\n    return;\n  }\n  if (modelValue.value.length < 1) {\n    selectAll();\n  } else {\n    deselectAll();\n  }\n}\n\nfunction selectAll() {\n  const newValue = computedOptions.value.map((option) => option.value);\n  emit('input', newValue);\n  emit('change', newValue);\n  emit('update:modelValue', newValue);\n}\n\nfunction deselectAll() {\n  const newValue = [];\n  emit('input', newValue);\n  emit('change', newValue);\n  emit('update:modelValue', newValue);\n}\n</script>\n\n<template>\n  <RobustInputWrapper\n    ref=\"refSelectWrapper\"\n    type=\"button\"\n    :title=\"title\"\n    :hint=\"hint\"\n    :error=\"error\"\n    :class=\"$props.class\"\n    :readonly=\"readonly\"\n    :condensed=\"condensed\"\n    v-bind=\"$attrs\"\n    @click.stop=\"openDropdown\"\n    @focus.stop=\"openDropdown\"\n    @blur.stop=\"closeDropdown\"\n  >\n    <div\n      v-if=\"$slots.prefix\"\n      class=\"pointer-events-none flex h-full select-none items-center pr-2 text-gray-400\"\n      :class=\"[condensed ? 'pl-2' : 'pl-3']\"\n    >\n      <slot tag=\"div\" name=\"prefix\" />\n    </div>\n    <div\n      ref=\"refSelect\"\n      class=\"relative flex h-full min-w-0 flex-1 flex-shrink items-center bg-transparent text-current outline-none\"\n      :class=\"[$slots.prefix || condensed ? 'pl-2' : 'pl-3']\"\n      v-bind=\"$attrs\"\n    >\n      <div\n        :class=\"[!open || !searchable ? 'opacity-100' : 'opacity-0']\"\n        class=\"min-w-0 select-none truncate\"\n      >\n        {{ getInputTitle() }}\n      </div>\n      <input\n        v-if=\"open && searchable\"\n        ref=\"refSelectInput\"\n        v-model=\"search\"\n        class=\"pointer-events-none absolute block h-full w-full min-w-0 select-none bg-transparent text-current outline-none\"\n        :class=\"[$slots.prefix || condensed ? 'pl-2' : 'pl-3']\"\n      />\n    </div>\n\n    <div\n      class=\"pointer-events-none flex h-full flex-shrink-0 select-none items-center pr-3 text-gray-400 dark:text-gray-500\"\n      :class=\"[condensed ? 'pl-2' : 'pl-3']\"\n    >\n      <PhCaretDown\n        :size=\"14\"\n        weight=\"bold\"\n        class=\"transition-transform duration-200\"\n        :class=\"{ 'rotate-180 transform': open }\"\n      />\n    </div>\n  </RobustInputWrapper>\n  <FLoating\n    v-if=\"refSelectWrapper?.wrapperRef\"\n    ref=\"elementRef\"\n    v-model:open=\"open\"\n    same-size\n    class=\"z-[100] origin-top select-none overflow-hidden\"\n    :reference=\"refSelectWrapper?.wrapperRef\"\n    :middleware=\"middleware\"\n  >\n    <div v-if=\"Array.isArray(modelValue)\" class=\"flex justify-end px-4 py-2\">\n      <button type=\"button\" class=\"select-none font-light\" @click=\"controlAll\">\n        <div v-if=\"Array.isArray(modelValue) && modelValue.length > 0\">\n          Clear all\n        </div>\n        <div v-else>Select all</div>\n      </button>\n    </div>\n    <div v-if=\"computedOptions.length > 0\" class=\"max-h-72 overflow-auto\">\n      <button\n        v-for=\"option in computedOptions\"\n        :key=\"String(option.value)\"\n        type=\"button\"\n        class=\"flex w-full min-w-0 max-w-full items-center gap-4 whitespace-pre-wrap px-4 py-2 text-left transition-colors duration-200 hover:bg-gray-100 dark:hover:bg-gray-700\"\n        :class=\"option.class\"\n        @click=\"selectItem(option)\"\n      >\n        <span>{{ option.title }}</span>\n        <PhCheck\n          v-if=\"optionSelected(option)\"\n          class=\"ml-auto flex-shrink-0 text-gray-400\"\n          weight=\"bold\"\n          size=\"14\"\n        />\n      </button>\n    </div>\n    <div v-else class=\"py-2 text-center text-gray-400\">No options</div>\n  </FLoating>\n</template>\n"],"names":["__default__","props","__props","emit","__emit","refSelectInput","ref","refSelectWrapper","options","modelValue","toRefs","open","elementRef","search","middleware","computedOptions","filterBySearchTerm","value","option","debouncedWatch","onClickOutside","event","_a","resetFields","closeDropdown","openDropdown","sortOptionsBySelected","nextTick","onMounted","activeItem","computed","item","selectItem","updatedValue","v","optionSelected","getInputTitle","titles","found","o","selectedOptions","notSelectedOptions","controlAll","selectAll","deselectAll","newValue"],"mappings":"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"}