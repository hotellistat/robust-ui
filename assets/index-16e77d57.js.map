{"version":3,"file":"index-16e77d57.js","sources":["../../src/components/Select/index.vue"],"sourcesContent":["<script lang=\"ts\">\nexport default {\n  name: 'RobustSelect',\n  inheritAttrs: false,\n};\n</script>\n\n<script lang=\"ts\" setup>\nimport RobustInputWrapper from '../InputWrapper/index.vue';\nimport RobustPopper from '../Popper';\nimport { ref, computed, nextTick, toRefs, onMounted } from 'vue';\nimport { debouncedWatch } from '@vueuse/core';\nimport { Modifier } from '@popperjs/core';\nimport { onClickOutside } from '@vueuse/core';\nimport { PhCheck, PhCaretDown } from '@phosphor-icons/vue';\n\nexport type Value = string | number | boolean | null | undefined;\n\nexport interface Option {\n  title: string;\n  value: Value;\n}\n\nconst props = withDefaults(\n  defineProps<{\n    title?: string;\n    zIndex?: string;\n    hint?: string;\n    error?: string;\n    class?: string;\n    modelValue?: Value | Array<Value>;\n    options: Array<Option>;\n    condensed: boolean;\n    searchable: boolean;\n    readonly: boolean;\n    searchFunction?: (query: string) => Promise<Array<Option>>;\n  }>(),\n  {\n    title: undefined,\n    hint: undefined,\n    error: undefined,\n    class: undefined,\n    modelValue: undefined,\n    zIndex: 'z-[50]',\n    condensed: false,\n    searchable: true,\n    readonly: false,\n    searchFunction: undefined,\n  }\n);\n\nconst emit = defineEmits([\n  'update:modelValue',\n  'input',\n  'change',\n  'focus',\n  'blur',\n]);\n// const refSelectContainer = ref()\nconst refSelectInput = ref();\n\nconst refSelectWrapper = ref();\nconst { options, modelValue } = toRefs(props);\n\nconst anchorRef = ref();\n\nconst open = ref(false);\nconst popperRef = ref();\n// const inputWrapper = ref()\n\nconst search = ref('');\n\nconst computedOptions = ref<Option[]>([]);\n\nasync function filterBySearchTerm(value) {\n  if (props.searchFunction !== undefined) {\n    computedOptions.value = await props.searchFunction(value);\n  }\n\n  if (value === '') {\n    computedOptions.value = options.value;\n  } else {\n    computedOptions.value = options.value.filter((option) =>\n      option.title.toLowerCase().includes(value.toLowerCase())\n    );\n  }\n}\n\ndebouncedWatch(\n  [search, options],\n  async ([value, optValue]) => {\n    await filterBySearchTerm(value);\n  },\n  { debounce: 150 }\n);\n\nonMounted(async () => {\n  await filterBySearchTerm('');\n});\n\nconst popperModifiers: Array<\n  Partial<Modifier<string, Record<string, unknown>>>\n> = [\n  {\n    name: 'sameWidth',\n    enabled: true,\n    phase: 'beforeWrite',\n    requires: ['computeStyles'],\n    fn: (args) => {\n      args.state.styles.popper.width = `${Math.max(\n        args.state.rects.reference.width,\n        200\n      )}px`;\n    },\n    effect: (args) => {\n      args.state.elements.popper.style.width = `${\n        args.state.elements.reference.getBoundingClientRect().width\n      }px`;\n    },\n  },\n];\n\nconst activeItem = computed(() => {\n  return props.options.find((item) => item.value === props.modelValue);\n});\n\nfunction selectItem(item) {\n  if (Array.isArray(modelValue.value)) {\n    let updatedValue = modelValue.value;\n    if (modelValue.value.includes(item.value)) {\n      updatedValue = modelValue.value.filter((v) => v !== item.value);\n    } else {\n      updatedValue = [...updatedValue, item.value];\n    }\n    emit('input', updatedValue);\n    emit('change', updatedValue);\n    emit('update:modelValue', updatedValue);\n  } else {\n    emit('input', item.value);\n    if (item.value !== props.modelValue) {\n      emit('change', item.value);\n      emit('update:modelValue', item.value);\n    }\n    nextTick(() => {\n      closeDropdown();\n      emit('blur');\n    });\n  }\n}\n\nfunction openDropdown() {\n  open.value = true;\n  sortOptionsBySelected();\n  nextTick(() => {\n    refSelectInput.value.focus();\n  });\n  emit('focus');\n}\n\nonClickOutside(popperRef, (event) => {\n  if (open.value) {\n    if (anchorRef.value.contains(event.target)) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n    resetFields();\n    closeDropdown();\n    emit('blur');\n  }\n});\n\nfunction closeDropdown() {\n  open.value = false;\n}\n\nfunction resetFields() {\n  search.value = '';\n}\n\n// returns if options is selected\n// in form of boolean\nfunction optionSelected(option: any) {\n  if (Array.isArray(modelValue.value)) {\n    return modelValue.value.includes(option.value);\n  }\n  return modelValue.value === option.value;\n}\n\nfunction getInputTitle() {\n  if (Array.isArray(modelValue.value)) {\n    if (modelValue.value.length < 1) return 'Select';\n    const titles = [];\n    for (const value of modelValue.value) {\n      const found = options.value.find((o) => o.value === value);\n      titles.push(found.title);\n    }\n    return titles.join(', ');\n  } else {\n    return activeItem.value ? activeItem.value.title : 'Select';\n  }\n}\n\nfunction sortOptionsBySelected() {\n  if (Array.isArray(modelValue.value)) {\n    const selectedOptions = [];\n    const notSelectedOptions = [];\n\n    for (const option of computedOptions.value) {\n      if (modelValue.value.includes(option.value)) selectedOptions.push(option);\n      else notSelectedOptions.push(option);\n    }\n\n    computedOptions.value = [...selectedOptions, ...notSelectedOptions];\n    console.log(computedOptions.value);\n  }\n}\n\nfunction controlAll() {\n  if (!Array.isArray(modelValue.value)) return;\n  if (modelValue.value.length < 1) selectAll();\n  else deselectAll();\n}\n\nfunction selectAll() {\n  const newValue = computedOptions.value.map((option) => option.value);\n  emit('input', newValue);\n  emit('change', newValue);\n  emit('update:modelValue', newValue);\n}\n\nfunction deselectAll() {\n  const newValue = [];\n  emit('input', newValue);\n  emit('change', newValue);\n  emit('update:modelValue', newValue);\n}\n</script>\n\n<template>\n  <div ref=\"anchorRef\">\n    <RobustInputWrapper\n      v-if=\"searchable\"\n      ref=\"refSelectWrapper\"\n      v-slot=\"slotProps\"\n      :title=\"title\"\n      :hint=\"hint\"\n      :error=\"error\"\n      :class=\"$props.class\"\n      class=\"\"\n      :readonly=\"readonly\"\n      :condensed=\"condensed\"\n      @click=\"openDropdown\"\n      @focus=\"openDropdown\"\n      @blur=\"closeDropdown\"\n    >\n      <div\n        v-if=\"$slots.prefix\"\n        class=\"flex h-full items-center pr-2 text-gray-400\"\n        :class=\"[condensed ? 'pl-2' : 'pl-3']\"\n      >\n        <slot tag=\"div\" name=\"prefix\" />\n      </div>\n      <div\n        v-show=\"!open\"\n        :id=\"slotProps.cuid\"\n        ref=\"select\"\n        class=\"flex h-full min-w-0 flex-1 flex-shrink items-center bg-transparent text-current outline-none\"\n        :class=\"[$slots.prefix || condensed ? 'pl-2' : 'pl-3']\"\n        v-bind=\"$attrs\"\n      >\n        <div class=\"min-w-0 select-none truncate\">\n          {{ getInputTitle() }}\n        </div>\n      </div>\n      <input\n        v-show=\"open\"\n        ref=\"refSelectInput\"\n        v-model=\"search\"\n        size=\"1\"\n        class=\"block h-full min-w-0 flex-1 flex-shrink bg-transparent text-current outline-none\"\n        :class=\"[$slots.prefix || condensed ? 'pl-2' : 'pl-3']\"\n      />\n\n      <div\n        class=\"flex h-full flex-shrink-0 items-center pr-3 text-gray-400 dark:text-gray-500\"\n        :class=\"[condensed ? 'pl-2' : 'pl-3']\"\n      >\n        <PhCaretDown\n          :size=\"14\"\n          weight=\"bold\"\n          class=\"transition-transform duration-200\"\n          :class=\"{ 'rotate-180 transform': open }\"\n        />\n      </div>\n    </RobustInputWrapper>\n    <RobustInputWrapper\n      v-else\n      ref=\"refSelectWrapper\"\n      :title=\"title\"\n      :hint=\"hint\"\n      :error=\"error\"\n      :class=\"$props.class\"\n      class=\"\"\n      :readonly=\"readonly\"\n      :condensed=\"condensed\"\n      @click=\"openDropdown\"\n      @focus=\"openDropdown\"\n      @blur=\"closeDropdown\"\n    >\n      <div\n        class=\"flex h-full min-w-0 flex-1 flex-shrink items-center bg-transparent text-current outline-none\"\n        :class=\"[$slots.prefix || condensed ? 'pl-2' : 'pl-3']\"\n      >\n        <div class=\"min-w-0 select-none truncate\">\n          {{ activeItem ? activeItem.title : 'Select' }}\n        </div>\n      </div>\n      <div\n        class=\"flex h-full flex-shrink-0 items-center pr-3 text-gray-400 dark:text-gray-500\"\n        :class=\"[condensed ? 'pl-2' : 'pl-3']\"\n      >\n        <PhCaretDown\n          :size=\"14\"\n          weight=\"bold\"\n          class=\"transition-transform duration-200\"\n          :class=\"{ 'rotate-180 transform': open }\"\n        />\n      </div>\n    </RobustInputWrapper>\n  </div>\n  <RobustPopper\n    v-if=\"refSelectWrapper?.wrapperRef\"\n    ref=\"popperRef\"\n    v-model:open=\"open\"\n    class=\"z-[100] origin-top\"\n    :append-to=\"refSelectWrapper?.wrapperRef\"\n    :modifiers=\"popperModifiers\"\n    :options=\"{\n      placement: 'bottom-start',\n    }\"\n    @closed=\"resetFields\"\n  >\n    <div v-if=\"Array.isArray(modelValue)\" class=\"flex justify-end py-2 px-4\">\n      <div class=\"cursor-pointer font-light\" @click=\"controlAll\">\n        <div v-if=\"Array.isArray(modelValue) && modelValue.length > 0\">\n          Clear all\n        </div>\n        <div v-else>Select all</div>\n      </div>\n    </div>\n    <ul v-if=\"computedOptions.length > 0\" class=\"max-h-72 overflow-auto\">\n      <li\n        v-for=\"option in computedOptions\"\n        :key=\"String(option.value)\"\n        class=\"flex cursor-default items-center gap-4 px-4 py-2 transition-colors duration-200 hover:bg-gray-100 dark:hover:bg-gray-700\"\n        @click=\"selectItem(option)\"\n      >\n        <span>{{ option.title }}</span>\n        <PhCheck\n          v-if=\"optionSelected(option)\"\n          class=\"ml-auto flex-shrink-0 text-gray-400\"\n          weight=\"bold\"\n          size=\"14\"\n        />\n      </li>\n    </ul>\n    <div v-else class=\"py-2 text-center text-gray-400\">No options</div>\n  </RobustPopper>\n</template>\n"],"names":["__default__","refSelectInput","ref","refSelectWrapper","options","modelValue","toRefs","props","anchorRef","open","popperRef","search","computedOptions","filterBySearchTerm","value","option","debouncedWatch","optValue","onMounted","popperModifiers","args","activeItem","computed","item","selectItem","updatedValue","v","emit","nextTick","closeDropdown","openDropdown","sortOptionsBySelected","onClickOutside","event","resetFields","optionSelected","getInputTitle","titles","found","o","selectedOptions","notSelectedOptions","controlAll","selectAll","deselectAll","newValue"],"mappings":"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"}